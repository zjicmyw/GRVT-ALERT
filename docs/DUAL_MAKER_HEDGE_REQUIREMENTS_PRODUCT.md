# GRVT 双账户 Maker 对冲需求（产品视角）

## 1. 产品定位
- 目标用户：已有 GRVT 双账户、希望用低手续费方式管理持仓量的交易者。
- 核心价值：
- 全程 maker，对冲成本更低
- 持仓可增可减（按标的独立配置）
- 规则可控、告警完整

## 2. 成功标准
- 系统在不主动吃单的前提下持续运行。
- 对冲成交价满足不亏损约束。
- 标的可以按 `increase` 或 `decrease` 模式独立运行。
- 风险告警可及时触达（MMR、stuck、冷却等）。

## 3. 业务规则（产品口径）
### 3.1 Maker 硬约束
- 策略不允许主动吃单。
- 下单必须为 maker 限价单。

### 3.2 不亏损对冲
- A 买成交价为 `P`，B 的对应卖价不能低于 `P`。
- B 卖成交价为 `P`，A 的对应买价不能高于 `P`。

### 3.3 增仓 / 减仓
- `increase`：增加总持仓。
- `decrease`：减少总持仓。
- 不同标的可以配置不同模式。

### 3.4 持仓边界
- 增仓模式受 `max_total_position_usdt` 约束。
- 减仓模式受 `min_total_position_usdt` 约束。
- 边界处应阻止越界方向，不应直接让策略整体失效。

### 3.5 低差额挂单约束
- 当某标的 A/B 持仓差小于 `20U` 时：
- A 账户该标的最多 1 单。
- B 账户该标的最多 1 单。

### 3.6 老单与人工单
- 老策略单保留。
- 人工/非策略单保留并告警。
- 人工单不应被策略当成策略单处理。

### 3.7 部分成交
- 部分成交先等待，最长 30 分钟。
- 超时后按已成交部分进入对冲计算。

## 4. 风险与告警（产品行为）
- `maintenance_margin / equity >= 70%`：即时告警。
- 未完成对冲超过 6h：即时告警 + 日报。
- post-only 连续失败：进入冷却并告警。
- 风险策略为“告警不停机”。
- 支持按测试时长自动停止，并在停止时自动清理策略挂单（可配置保留数量）。

## 5. 典型场景
### 5.1 增仓场景（BNB）
1. A/B 同时挂相反方向 maker 单（如 A 买、B 卖）。
2. 若 A 先成交，B 保留老单并补对冲卖单（满足保本约束）。
3. 若 B 再成交，轮到 A 侧补单。

### 5.2 减仓场景
1. 标的设为 `position_mode=decrease`。
2. 策略优先朝“减少当前仓位”的方向挂单。
3. 到达 `min_total_position_usdt` 后不再继续缩减。

## 6. 配置体验要求
- 标的配置应放在独立 JSON 文件，避免 `.env` 中塞长 JSON。
- 必须有示例模板可直接复制。
- `.env.example` 中每个新增参数都要有中文注释。
- 低差额限单阈值应可配置（默认 20U）。

## 7. 验收（产品验收）
1. 双模式（increase/decrease）按标的生效。
2. 实时告警、日报可用。
3. 不会误撤人工单。
4. 边界控制有效。
5. 连续运行稳定。

## 8. 相关文档
- 工程实现：`docs/DUAL_MAKER_HEDGE_REQUIREMENTS_ENGINEERING.md`
- 总需求：`docs/DUAL_MAKER_HEDGE_REQUIREMENTS.md`
- 运行手册：`docs/DUAL_MAKER_HEDGE_RUNBOOK.md`
